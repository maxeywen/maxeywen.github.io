<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Predicting Activity</title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>




</head>

<body>
<h1>Predicting Activity</h1>

<h2>Abstract</h2>

<h2>Data Source</h2>

<p>The data used here comes from research conducted in conjunction with the publishing of the paper Qualitative Activity Recognition of Weight Lifting Exercises [1].  The paper describes:</p>

<p><em>Six young health participants were asked to perform one set of 10 repetitions of the Unilateral Dumbbell Biceps Curl in five different fashions: exactly according to the specification (Class A), throwing the elbows to the front (Class B), lifting the dumbbell only halfway (Class C), lowering the dumbbell only halfway (Class D) and throwing the hips to the front (Class E).</em></p>

<p>Sensors placed on the arm (bicep), forearm, belt, and dumbell record data as the movements are performed.  The data set is comprised of over 19,000 observations, each with 52 sensor readings.</p>

<p>The goal here is to use this data to build a machine learning model to predict the activity performed.</p>

<h2>Getting &amp; Pre-processing</h2>

<p>The data can be downloaded from <a href="http://groupware.les.inf.puc-rio.br/static/WLE/WearableComputing_weight_lifting_exercises_biceps_curl_variations.csv">http://groupware.les.inf.puc-rio.br/static/WLE/WearableComputing_weight_lifting_exercises_biceps_curl_variations.csv</a>.</p>

<p>The data set is full of many summary variables with NA or no data.  The first step removes all of these.  Also removed because I do not intend to use them in the model are names and time stamps.  For simplicity this was done in a spreadsheet before opening the first time in R.</p>

<pre><code class="r">raw.data &lt;- read.csv(&quot;../../data/train.csv&quot;)
</code></pre>

<p>Before splitting the data into train/test I want to check for any potential predictors that have near-zero variance since they would not contribute to the model.  The caret package includes nearZeroVar to do this.</p>

<pre><code class="r">library(caret)
nzv &lt;- nearZeroVar(raw.data, saveMetrics = TRUE)
nzv[nzv$nzv, ]
</code></pre>

<pre><code>## [1] freqRatio     percentUnique zeroVar       nzv          
## &lt;0 rows&gt; (or 0-length row.names)
</code></pre>

<p>The results show no features with low variance.</p>

<p>Next a check for highly correlated variables.  </p>

<pre><code class="r">descrCor &lt;- cor(raw.data[,-53])
highCorr &lt;- sum(abs(descrCor[upper.tri(descrCor)]) &gt; 0.999)
highCorr
</code></pre>

<pre><code>## [1] 0
</code></pre>

<p>Once again ther are no features to remove.</p>

<p>At this point I am satisfied to split the data and start developing a model.</p>

<pre><code class="r">inTrain &lt;- createDataPartition(y=raw.data$classe,p=0.6, list=FALSE)
training &lt;- raw.data[inTrain,]
testing &lt;- raw.data[-inTrain,]

inTest &lt;- createDataPartition(y=testing$classe,p=0.5, list=FALSE)
cv.data &lt;- testing[-inTest,]
testing &lt;- testing[inTest,]

#rm(raw.data, inTrain, inTest)
</code></pre>

<p>The split is 60/20/20 into training/testing/cross-validation (cv.data)</p>

<h2>EDA</h2>

<h3>Model fitting</h3>

<h4>Random forests</h4>

<pre><code class="r">library(randomForest)
</code></pre>

<p>Tuning it first for the variable mtry can save time later since the optimal value can be specified in the model and therefore the model will not re-tune on every run.</p>

<pre><code class="r">tuned &lt;- tuneRF(training[,-53],training[,53])  
</code></pre>

<pre><code>## mtry = 7  OOB error = 1.15% 
## Searching left ...
## mtry = 4     OOB error = 1.1% 
## 0.03704 0.05 
## Searching right ...
## mtry = 14    OOB error = 1.11% 
## 0.02963 0.05
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk tunerf"/> </p>

<p>The result says that mtry = 4 is the optimal value, although they are all very close.  But should still speed the model up to specify this value</p>

<p>Now the model will be built.  The other parameter of interest is ntree, the number of trees the model will build.  Different values were tried but I won&#39;t show them all here.  A first model of ntree=10 was tried just to gauge speed.  This model went very fast and the OOB estimate of the error was 5.25%.  It is correct to assume as ntree is increased the estimate will decrease, although not forever.  Beyond ntree=500, trials of 1000 and 2000 showed little marginal return and obviously were slower.  So here is shown only the final model run.</p>

<pre><code class="r">rf.model &lt;- randomForest(classe~., data=training, ntree= 500, mtry=4)
print(rf.model)
</code></pre>

<pre><code>## 
## Call:
##  randomForest(formula = classe ~ ., data = training, ntree = 500,      mtry = 4) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 4
## 
##         OOB estimate of  error rate: 0.72%
## Confusion matrix:
##      A    B    C    D    E class.error
## A 3343    3    1    0    1    0.001493
## B   13 2259    7    0    0    0.008776
## C    0   19 2032    3    0    0.010711
## D    0    0   31 1897    2    0.017098
## E    0    0    1    4 2160    0.002309
</code></pre>

<p>The randomForest() model calculates an estimate for OOB error and for this model it predicts 0.72%.</p>

<p>Here is a visulization of the random forest model</p>

<pre><code class="r">library(rattle)
fancyRpartPlot(rf.model$finalModel)
</code></pre>

<pre><code>## Error: argument is of length zero
</code></pre>

<h2>Model Results</h2>

<p>All models were run against testing to verify performance but once again only the final prediction will be shown. </p>

<pre><code class="r">pred.test &lt;- predict(rf.model,testing)
test.table &lt;- table(pred.test,testing$classe)
test.cm &lt;- confusionMatrix(test.table)
test.cm$table
</code></pre>

<pre><code>##          
## pred.test    A    B    C    D    E
##         A 1114    2    0    0    0
##         B    1  754   11    0    0
##         C    0    3  673    7    0
##         D    0    0    0  635    0
##         E    1    0    0    1  721
</code></pre>

<pre><code class="r">test.cm$overall[1]
</code></pre>

<pre><code>## Accuracy 
##   0.9934
</code></pre>

<p>The error on this iteration was 0.66%, extremely close to the model estimate.  Because the estimate and actual were so close, we should expect the model to do similarly well with the cross-validation set.</p>

<h2>Cross Validation</h2>

<p>Since the model was fitted against training and repeatedly verified against testing it is wise to do one more validation of the model against data that has not been used.  That is the purpose of the cross-validation data set.</p>

<pre><code class="r">cv.pred &lt;- predict(rf.model,cv.data)
cv.table &lt;- table(cv.pred,cv.data$classe)
cv.cm &lt;- confusionMatrix(cv.table)
cv.cm$table
</code></pre>

<pre><code>##        
## cv.pred    A    B    C    D    E
##       A 1116    7    0    0    0
##       B    0  750    6    0    0
##       C    0    2  677    9    0
##       D    0    0    1  633    0
##       E    0    0    0    1  721
</code></pre>

<pre><code class="r">cv.cm$overall[1]
</code></pre>

<pre><code>## Accuracy 
##   0.9934
</code></pre>

<p>Once again the error was 0.66%, matching the error of the testing predictions.  This similarity of error proviedes confidence in the predictive ability of the model.</p>

<h2>Conclusion</h2>

<p>The </p>

<h2>References</h2>

<ol>
<li>Velloso, E.; Bulling, A.; Gellersen, H.; Ugulino, W.; Fuks, H. Qualitative Activity Recognition of Weight Lifting Exercises. Proceedings of 4th International Conference in Cooperation with SIGCHI (Augmented Human &#39;13) . Stuttgart, Germany: ACM SIGCHI, 2013.</li>
</ol>

<h2>Appendix</h2>

<h3>data set feature names</h3>

<pre><code class="r">summary(raw.data)
</code></pre>

<pre><code>##    roll_belt       pitch_belt        yaw_belt      total_accel_belt
##  Min.   :-28.9   Min.   :-55.80   Min.   :-180.0   Min.   : 0.0    
##  1st Qu.:  1.1   1st Qu.:  1.76   1st Qu.: -88.3   1st Qu.: 3.0    
##  Median :113.0   Median :  5.28   Median : -13.0   Median :17.0    
##  Mean   : 64.4   Mean   :  0.31   Mean   : -11.2   Mean   :11.3    
##  3rd Qu.:123.0   3rd Qu.: 14.90   3rd Qu.:  12.9   3rd Qu.:18.0    
##  Max.   :162.0   Max.   : 60.30   Max.   : 179.0   Max.   :29.0    
##   gyros_belt_x      gyros_belt_y      gyros_belt_z     accel_belt_x    
##  Min.   :-1.0400   Min.   :-0.6400   Min.   :-1.460   Min.   :-120.00  
##  1st Qu.:-0.0300   1st Qu.: 0.0000   1st Qu.:-0.200   1st Qu.: -21.00  
##  Median : 0.0300   Median : 0.0200   Median :-0.100   Median : -15.00  
##  Mean   :-0.0056   Mean   : 0.0396   Mean   :-0.131   Mean   :  -5.59  
##  3rd Qu.: 0.1100   3rd Qu.: 0.1100   3rd Qu.:-0.020   3rd Qu.:  -5.00  
##  Max.   : 2.2200   Max.   : 0.6400   Max.   : 1.620   Max.   :  85.00  
##   accel_belt_y    accel_belt_z    magnet_belt_x   magnet_belt_y
##  Min.   :-69.0   Min.   :-275.0   Min.   :-52.0   Min.   :354  
##  1st Qu.:  3.0   1st Qu.:-162.0   1st Qu.:  9.0   1st Qu.:581  
##  Median : 35.0   Median :-152.0   Median : 35.0   Median :601  
##  Mean   : 30.1   Mean   : -72.6   Mean   : 55.6   Mean   :594  
##  3rd Qu.: 61.0   3rd Qu.:  27.0   3rd Qu.: 59.0   3rd Qu.:610  
##  Max.   :164.0   Max.   : 105.0   Max.   :485.0   Max.   :673  
##  magnet_belt_z     roll_arm        pitch_arm         yaw_arm       
##  Min.   :-623   Min.   :-180.0   Min.   :-88.80   Min.   :-180.00  
##  1st Qu.:-375   1st Qu.: -31.8   1st Qu.:-25.90   1st Qu.: -43.10  
##  Median :-320   Median :   0.0   Median :  0.00   Median :   0.00  
##  Mean   :-346   Mean   :  17.8   Mean   : -4.61   Mean   :  -0.62  
##  3rd Qu.:-306   3rd Qu.:  77.3   3rd Qu.: 11.20   3rd Qu.:  45.88  
##  Max.   : 293   Max.   : 180.0   Max.   : 88.50   Max.   : 180.00  
##  total_accel_arm  gyros_arm_x      gyros_arm_y      gyros_arm_z   
##  Min.   : 1.0    Min.   :-6.370   Min.   :-3.440   Min.   :-2.33  
##  1st Qu.:17.0    1st Qu.:-1.330   1st Qu.:-0.800   1st Qu.:-0.07  
##  Median :27.0    Median : 0.080   Median :-0.240   Median : 0.23  
##  Mean   :25.5    Mean   : 0.043   Mean   :-0.257   Mean   : 0.27  
##  3rd Qu.:33.0    3rd Qu.: 1.570   3rd Qu.: 0.140   3rd Qu.: 0.72  
##  Max.   :66.0    Max.   : 4.870   Max.   : 2.840   Max.   : 3.02  
##   accel_arm_x      accel_arm_y      accel_arm_z      magnet_arm_x 
##  Min.   :-404.0   Min.   :-318.0   Min.   :-636.0   Min.   :-584  
##  1st Qu.:-242.0   1st Qu.: -54.0   1st Qu.:-143.0   1st Qu.:-300  
##  Median : -44.0   Median :  14.0   Median : -47.0   Median : 289  
##  Mean   : -60.2   Mean   :  32.6   Mean   : -71.2   Mean   : 192  
##  3rd Qu.:  84.0   3rd Qu.: 139.0   3rd Qu.:  23.0   3rd Qu.: 637  
##  Max.   : 437.0   Max.   : 308.0   Max.   : 292.0   Max.   : 782  
##   magnet_arm_y   magnet_arm_z  roll_dumbbell    pitch_dumbbell  
##  Min.   :-392   Min.   :-597   Min.   :-153.7   Min.   :-149.6  
##  1st Qu.:  -9   1st Qu.: 131   1st Qu.: -18.5   1st Qu.: -40.9  
##  Median : 202   Median : 444   Median :  48.2   Median : -21.0  
##  Mean   : 157   Mean   : 306   Mean   :  23.8   Mean   : -10.8  
##  3rd Qu.: 323   3rd Qu.: 545   3rd Qu.:  67.6   3rd Qu.:  17.5  
##  Max.   : 583   Max.   : 694   Max.   : 153.6   Max.   : 149.4  
##   yaw_dumbbell     total_accel_dumbbell gyros_dumbbell_x  gyros_dumbbell_y
##  Min.   :-150.87   Min.   : 0.0         Min.   :-204.00   Min.   :-2.10   
##  1st Qu.: -77.64   1st Qu.: 4.0         1st Qu.:  -0.03   1st Qu.:-0.14   
##  Median :  -3.32   Median :10.0         Median :   0.13   Median : 0.03   
##  Mean   :   1.67   Mean   :13.7         Mean   :   0.16   Mean   : 0.05   
##  3rd Qu.:  79.64   3rd Qu.:19.0         3rd Qu.:   0.35   3rd Qu.: 0.21   
##  Max.   : 154.95   Max.   :58.0         Max.   :   2.22   Max.   :52.00   
##  gyros_dumbbell_z accel_dumbbell_x accel_dumbbell_y accel_dumbbell_z
##  Min.   : -2.4    Min.   :-419.0   Min.   :-189.0   Min.   :-334.0  
##  1st Qu.: -0.3    1st Qu.: -50.0   1st Qu.:  -8.0   1st Qu.:-142.0  
##  Median : -0.1    Median :  -8.0   Median :  41.5   Median :  -1.0  
##  Mean   : -0.1    Mean   : -28.6   Mean   :  52.6   Mean   : -38.3  
##  3rd Qu.:  0.0    3rd Qu.:  11.0   3rd Qu.: 111.0   3rd Qu.:  38.0  
##  Max.   :317.0    Max.   : 235.0   Max.   : 315.0   Max.   : 318.0  
##  magnet_dumbbell_x magnet_dumbbell_y magnet_dumbbell_z  roll_forearm    
##  Min.   :-643      Min.   :-3600     Min.   :-262.0    Min.   :-180.00  
##  1st Qu.:-535      1st Qu.:  231     1st Qu.: -45.0    1st Qu.:  -0.74  
##  Median :-479      Median :  311     Median :  13.0    Median :  21.70  
##  Mean   :-328      Mean   :  221     Mean   :  46.1    Mean   :  33.83  
##  3rd Qu.:-304      3rd Qu.:  390     3rd Qu.:  95.0    3rd Qu.: 140.00  
##  Max.   : 592      Max.   :  633     Max.   : 452.0    Max.   : 180.00  
##  pitch_forearm     yaw_forearm     total_accel_forearm gyros_forearm_x  
##  Min.   :-72.50   Min.   :-180.0   Min.   :  0.0       Min.   :-22.000  
##  1st Qu.:  0.00   1st Qu.: -68.6   1st Qu.: 29.0       1st Qu.: -0.220  
##  Median :  9.24   Median :   0.0   Median : 36.0       Median :  0.050  
##  Mean   : 10.71   Mean   :  19.2   Mean   : 34.7       Mean   :  0.158  
##  3rd Qu.: 28.40   3rd Qu.: 110.0   3rd Qu.: 41.0       3rd Qu.:  0.560  
##  Max.   : 89.80   Max.   : 180.0   Max.   :108.0       Max.   :  3.970  
##  gyros_forearm_y  gyros_forearm_z  accel_forearm_x  accel_forearm_y
##  Min.   : -7.02   Min.   : -8.09   Min.   :-498.0   Min.   :-632   
##  1st Qu.: -1.46   1st Qu.: -0.18   1st Qu.:-178.0   1st Qu.:  57   
##  Median :  0.03   Median :  0.08   Median : -57.0   Median : 201   
##  Mean   :  0.08   Mean   :  0.15   Mean   : -61.7   Mean   : 164   
##  3rd Qu.:  1.62   3rd Qu.:  0.49   3rd Qu.:  76.0   3rd Qu.: 312   
##  Max.   :311.00   Max.   :231.00   Max.   : 477.0   Max.   : 923   
##  accel_forearm_z  magnet_forearm_x magnet_forearm_y magnet_forearm_z
##  Min.   :-446.0   Min.   :-1280    Min.   :-896     Min.   :-973    
##  1st Qu.:-182.0   1st Qu.: -616    1st Qu.:   2     1st Qu.: 191    
##  Median : -39.0   Median : -378    Median : 591     Median : 511    
##  Mean   : -55.3   Mean   : -313    Mean   : 380     Mean   : 394    
##  3rd Qu.:  26.0   3rd Qu.:  -73    3rd Qu.: 737     3rd Qu.: 653    
##  Max.   : 291.0   Max.   :  672    Max.   :1480     Max.   :1090    
##  classe  
##  A:5580  
##  B:3797  
##  C:3422  
##  D:3216  
##  E:3607  
## 
</code></pre>

</body>

</html>

